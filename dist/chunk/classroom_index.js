(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"100":function(e,t,n){},"241":function(e,t,n){},"84":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var a=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=_interopRequireDefault(n(7)),i=_interopRequireDefault(n(14)),s=_interopRequireDefault(n(16)),o=_interopRequireDefault(n(2));n(15);var l=n(91),u=n(95);n(241);var c=_interopRequireDefault(n(99)),d=_interopRequireDefault(n(96));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(a,r){try{var i=t[a](r),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then(function(e){step("next",e)},function(e){step("throw",e)});e(s)}("next")})}}var f=function(e){function Classroom(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Classroom);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Classroom.__proto__||Object.getPrototypeOf(Classroom)).apply(this,arguments));return e.config={"navigationBarTitleText":"课程详情列表"},e.state={"current":0,"value":"","course":null,"courseId":e.$router.params.id,"subVideos":[],"index":0,"isOpened":!1,"text":"","messages":[],"pay":0,"isDisplay":!1},e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Classroom,r.default.Component),a(Classroom,[{"key":"componentWillMount","value":function componentWillMount(){}},{"key":"componentDidMount","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var e,t,n,a,r=this;return regeneratorRuntime.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,!this.state.courseId){s.next=17;break}return e=new i.default.Query("Courses"),s.next=5,e.get(this.state.courseId);case 5:t=s.sent;try{t.increment("views",1),t.fetchWhenSave(!0),t.save()}catch(e){}return(n=new i.default.Query("Sub_video")).equalTo("course_id",t),n.limit(1e3),s.next=12,n.find(this.state.courseId);case 12:return a=s.sent,s.next=15,this.setState({"course":t,"subVideos":a});case 15:return s.next=17,this.queryIsPay();case 17:s.next=23;break;case 19:s.prev=19,s.t0=s.catch(0),this.setState({"isOpened":!0,"text":"网络错误"}),setTimeout(function(){r.setState({"isOpened":!1})},3e3);case 23:this.getMessages();case 24:case"end":return s.stop()}},_callee,this,[[0,19]])}));return function componentDidMount(){return e.apply(this,arguments)}}()},{"key":"queryIsPay","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var e;return regeneratorRuntime.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!i.default.User.current()){t.next=9;break}return(e=new i.default.Query("Orders")).equalTo("course",this.state.course),e.equalTo("user",i.default.User.current()),e.equalTo("pay",1),t.next=7,e.find();case 7:0!=t.sent.length&&this.setState({"pay":1});case 9:case"end":return t.stop()}},_callee2,this)}));return function queryIsPay(){return e.apply(this,arguments)}}()},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){var e=this;document.getElementById("video").setAttribute("controlsList","nodownload"),setTimeout(function(){document.getElementById("video").setAttribute("controlsList","nodownload"),e.onVideo()},1e3)}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"handleClick","value":function handleClick(e){this.setState({"current":e})}},{"key":"onClick","value":function onClick(e){console.log(e),this.setState({"index":e})}},{"key":"getCourse","value":function getCourse(e){if(this.state.course)return this.state.course.get(e)}},{"key":"getSubVideo","value":function getSubVideo(e){var t=this.state.subVideos[this.state.index];if(-1!=this.state.index&&t)return t.get(e)}},{"key":"handleChange","value":function handleChange(e){this.setState({"value":e.target.value})}},{"key":"onSendMessage","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var e,t,n,a=this;return regeneratorRuntime.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:if(0!=this.state.value.length){r.next=4;break}this.setState({"isOpened":!0,"text":"请输入留言"}),r.next=24;break;case 4:if(i.default.User.current()){r.next=8;break}this.setState({"isOpened":!0,"text":"请登录后留言"}),r.next=24;break;case 8:return e=this.state.subVideos[this.state.index],t=i.default.Object.extend("Message"),(n=new t).set("content",this.state.value),n.set("user",i.default.User.current()),n.set("sub_video",e),r.prev=14,r.next=17,n.save();case 17:this.setState({"value":""}),this.getMessages(),r.next=24;break;case 21:r.prev=21,r.t0=r.catch(14),this.setState({"isOpened":!0,"text":"网络错误"});case 24:setTimeout(function(){a.setState({"isOpened":!1})},3e3);case 25:case"end":return r.stop()}},_callee3,this,[[14,21]])}));return function onSendMessage(){return e.apply(this,arguments)}}()},{"key":"getMessages","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var e,t,n,a=this;return regeneratorRuntime.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return e=this.state.subVideos[this.state.index],(t=new i.default.Query("Message")).equalTo("sub_video",e),t.include("user"),t.descending("createdAt"),r.prev=5,r.next=8,t.find();case 8:n=r.sent,this.setState({"messages":n}),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(5),this.setState({"isOpened":!0,"text":"网络错误"});case 15:setTimeout(function(){a.setState({"isOpened":!1})},3e3);case 16:case"end":return r.stop()}},_callee4,this,[[5,12]])}));return function getMessages(){return e.apply(this,arguments)}}()},{"key":"onPay","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var e,t,n,a,r,o,l=this;return regeneratorRuntime.wrap(function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:if(i.default.User.current()){u.next=4;break}this.setState({"isOpened":!0,"text":"请登录"}),u.next=36;break;case 4:u.prev=4;try{(e=i.default.Object.createWithoutData("Courses",this.state.course.id)).increment("people",1),e.save()}catch(e){console.log(e)}return t=i.default.Object.extend("Orders"),(n=new t).set("title",this.state.course.get("title")),n.set("price",this.state.course.get("price")),n.set("course",this.state.course),n.set("user",i.default.User.current()),n.set("pay",0),u.next=15,n.save();case 15:if(n=u.sent,console.log("需要向后台发送",n.id),!this.isWeixn()){u.next=25;break}return u.next=21,s.default.post("/wechat/jsapipay/unifiedpay",{"orderId":n.id});case 21:a=u.sent,this.weixinPlay(a.data),u.next=29;break;case 25:return u.next=27,s.default.post("/wechat/qrcodepay/getqrcode",{"orderId":n.id});case 27:r=u.sent,this.setState({"codeStr":r.data,"isDisplay":!0});case 29:u.next=36;break;case 31:u.prev=31,u.t0=u.catch(4),o=JSON.stringify(u.t0),alert("error:"+o),this.setState({"isOpened":!0,"text":"网络错误"});case 36:setTimeout(function(){l.setState({"isOpened":!1})},3e3);case 37:case"end":return u.stop()}},_callee5,this,[[4,31]])}));return function onPay(){return e.apply(this,arguments)}}()},{"key":"isPlay","value":function isPlay(){if(i.default.User.current()&&0!=this.state.subVideos.length){var e=this.state.subVideos[this.state.index];return 0==e.get("pay")?e.get("video"):1===this.state.pay&&e.get("video")}}},{"key":"onVideo","value":function onVideo(){var e=this;i.default.User.current()||this.setState({"isOpened":!0,"text":"登录后才能观看"}),setTimeout(function(){e.setState({"isOpened":!1})},1e4)}},{"key":"onScanCode","value":function onScanCode(){window.location.reload()}},{"key":"isWeixn","value":function isWeixn(){return!!(-1!=navigator.userAgent.toLowerCase().indexOf("micromessenger"))}},{"key":"weixinPlay","value":function weixinPlay(e){var t=this;function onBridgeReady(){WeixinJSBridge.invoke("getBrandWCPayRequest",{"appId":e.appId,"timeStamp":e.timeStamp,"nonceStr":e.nonceStr,"package":e.package1,"signType":e.signType,"paySign":e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?t.onScanCode():alert("取消支付")})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):onBridgeReady()}},{"key":"onPrice","value":function onPrice(){return 0===this.getCourse("price")?"免费":this.getCourse("price")/100+"¥"}},{"key":"render","value":function render(){var e=this,t=this.state.subVideos.map(function(t,n){return o.default.createElement(l.Text,{"key":t.id,"onClick":e.onClick.bind(e,n),"className":"class-title"},t.get("title"))}),n=this.state.messages.map(function(e){return o.default.createElement(l.View,{"key":e.id},o.default.createElement(l.View,{"className":"message-left"},o.default.createElement(u.AtAvatar,{"circle":!0,"image":"http://lc-8emscetg.cn-n1.lcfile.com/2a5cb3bac7d2d578235a.png"})),o.default.createElement(l.View,{"className":"message-right"},o.default.createElement(l.View,{"className":"message-name"},o.default.createElement(l.Text,null,e.get("user").get("name")),o.default.createElement(l.Text,null,function formatDate(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd hh:mm:ss";/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var a in n)if(new RegExp("("+a+")").test(t)){var r=n[a]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?r:padLeftZero(r))}return t}(e.createdAt))),o.default.createElement(l.Text,{"className":"message -content"},e.get("content"))))}),a=0!=this.getCourse("price")&&(0==this.state.pay?o.default.createElement(l.Button,{"onClick":this.onPay.bind(this),"size":"mini","type":"primary"},"购买课程"):o.default.createElement(l.Text,null," 「已购买」"));return o.default.createElement(l.View,{"className":"classroom"},o.default.createElement(d.default,null),o.default.createElement(l.Image,{"className":"img","src":"http://lc-8emscetg.cn-n1.lcfile.com/1d2b680e87c3c5338482.png"}),o.default.createElement(l.View,{"className":"content"},o.default.createElement(l.View,{"className":"card","onClick":this.onVideo.bind(this)},o.default.createElement(l.Video,{"src":this.isPlay(),"autoplay":!1,"poster":this.getCourse("cover"),"controlsList":"nodownload","initialTime":"0","id":"video","loop":!1,"muted":!1}),o.default.createElement(l.View,{"className":"right"},o.default.createElement(l.View,{"className":"title"},o.default.createElement(l.Text,null,this.getCourse("title")),a),o.default.createElement(l.View,{"className":"sub-title"},"价格：",o.default.createElement(l.Text,{"className":"price"},this.onPrice(),"，"),o.default.createElement(l.Text,null,"已经加入 "+this.getCourse("people")+" 人")),o.default.createElement(l.View,{"className":"sub-title"},"本节课：",this.getSubVideo("title")),o.default.createElement(l.Text,{"className":"sub-title content","id":"people"},this.getSubVideo("content"))))),o.default.createElement(l.View,{"className":"content"},o.default.createElement(l.View,{"className":"card"},o.default.createElement(u.AtTabs,{"current":this.state.current,"tabList":[{"title":"课程介绍"},{"title":"课程目录"},{"title":"全部评论"}],"onClick":this.handleClick.bind(this)},o.default.createElement(u.AtTabsPane,{"current":this.state.current,"index":0},o.default.createElement(l.View,{"className":"tab-base"},o.default.createElement(l.RichText,{"nodes":this.state.course&&this.state.course.get("outline")}))),o.default.createElement(u.AtTabsPane,{"current":this.state.current,"index":1},o.default.createElement(l.View,{"className":"tab-base schedule"},t)),o.default.createElement(u.AtTabsPane,{"current":this.state.current,"index":2},o.default.createElement(l.View,{"className":"tab-base message-board"},o.default.createElement(u.AtTextarea,{"value":this.state.value,"onChange":this.handleChange.bind(this),"maxlength":"100","placeholder":"说说你的看法..."}),o.default.createElement(l.Button,{"size":"mini","onClick":this.onSendMessage.bind(this)},"发送"),o.default.createElement(l.View,{"className":"message-list"},o.default.createElement(l.View,{"className":"message-item"},n))))))),o.default.createElement(u.AtToast,{"isOpened":this.state.isOpened,"text":this.state.text}),o.default.createElement(l.View,{"id":"modal"},o.default.createElement(l.View,{"className":"show","style":{"display":this.state.isDisplay?"":"none"}},"请用微信扫码二维码，完成支付",o.default.createElement(l.Image,{"className":"img","src":"data:image/jpg;base64,"+this.state.codeStr}),o.default.createElement(l.Button,{"size":"mini","onClick":this.onScanCode.bind(this)},"关闭支付"),o.default.createElement(l.Button,{"size":"mini","onClick":this.onScanCode.bind(this)},"完成支付"))),o.default.createElement(c.default,null))}}]),Classroom}();function padLeftZero(e){return("00"+e).substr(e.length)}t.default=f},"96":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var a=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=_interopRequireDefault(n(7)),i=_interopRequireDefault(n(14)),s=_interopRequireDefault(n(2)),o=n(91);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(97);var l=function(e){function Head(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Head),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Head.__proto__||Object.getPrototypeOf(Head)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Head,r.default.Component),a(Head,[{"key":"onLogin","value":function onLogin(){r.default.navigateTo({"url":"/pages/login/index"})}},{"key":"onRegister","value":function onRegister(){r.default.navigateTo({"url":"/pages/register/index"})}},{"key":"onHome","value":function onHome(){r.default.navigateTo({"url":"/"})}},{"key":"onSignOut","value":function onSignOut(){i.default.User.logOut(),window.location.href="/"}},{"key":"onMe","value":function onMe(){r.default.navigateTo({"url":"/pages/me/index"})}},{"key":"onSkipFindPassword","value":function onSkipFindPassword(){r.default.navigateTo({"url":"/pages/findPassword/index"})}},{"key":"render","value":function render(){var e=i.default.User.current(),t=e?s.default.createElement(o.View,{"className":"right"},s.default.createElement(o.Text,null,"你好：",e.get("name")),s.default.createElement(o.Button,{"onClick":this.onMe.bind(this),"size":"mini","type":"primary"},"我的课程"),s.default.createElement(o.Button,{"onClick":this.onSkipFindPassword.bind(this),"size":"mini","type":"primary"},"修改密码"),s.default.createElement(o.Button,{"onClick":this.onSignOut.bind(this),"size":"mini","type":"primary"},"退出")):s.default.createElement(o.View,{"className":"right"},s.default.createElement(o.Button,{"onClick":this.onLogin.bind(this),"size":"mini","type":"primary"},"登录"),s.default.createElement(o.Button,{"onClick":this.onRegister.bind(this),"size":"mini","type":"primary"},"注册"));return s.default.createElement(o.View,{"className":"head"},s.default.createElement(o.View,{"className":"left","onClick":this.onHome.bind(this)},s.default.createElement(o.Image,{"className":"logo","src":"http://lc-8emscetg.cn-n1.lcfile.com/aaca1b144fd17a5e70f6.png"})),s.default.createElement(o.View,{"className":"right"},t))}}]),Head}();t.default=l},"97":function(e,t,n){},"99":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.default=void 0;var a=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),r=_interopRequireDefault(n(7)),i=_interopRequireDefault(n(2)),s=n(91),o=n(95);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(100);var l=function(e){function Fool(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Fool),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Fool.__proto__||Object.getPrototypeOf(Fool)).apply(this,arguments))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Fool,r.default.Component),a(Fool,[{"key":"onClick","value":function onClick(e,t){console.log(e,t)}},{"key":"render","value":function render(){return i.default.createElement(s.View,{"className":"fool"},i.default.createElement(o.AtGrid,{"className":"at-grid","onClick":this.onClick.bind(this),"mode":"rect","hasBorder":!1,"data":[{"image":"https://img30.360buyimg.com/jdphoto/s72x72_jfs/t5770/97/5184449507/2423/294d5f95/595c3b4dNbc6bc95d.png","value":"电话:1871795086"},{"image":"https://img12.360buyimg.com/jdphoto/s72x72_jfs/t10660/330/203667368/1672/801735d7/59c85643N31e68303.png","value":"邮箱:kaizkx@163.com"},{"image":"https://img20.360buyimg.com/jdphoto/s72x72_jfs/t15151/308/1012305375/2300/536ee6ef/5a411466N040a074b.png","value":"地址:上海虹口区"}]}),i.default.createElement(s.View,{"className":"tail"},i.default.createElement(s.Text,{"className":"tail-title"},"上海鹏祥医学科技有限公司"),i.default.createElement(s.Text,{"className":"tail-title"},"© 沪ICP备18040972号-1")),i.default.createElement(s.View,{"style":"width:300px;margin:0 auto; padding:20px 0;font-size: 15px;"},i.default.createElement("a",{"target":"_blank","href":" ","style":"display:inline-block;text-decoration:none;height:20px;line-height:20px;"},i.default.createElement("img",{"src":"http://lc-8emscetg.cn-n1.lcfile.com/69e10441d4e02e5f8fb5/gongan.png","style":"float:left;"}),i.default.createElement("p",{"style":"float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;"},"沪公网安备 31011002003701号"))))}}]),Fool}();t.default=l}}]);